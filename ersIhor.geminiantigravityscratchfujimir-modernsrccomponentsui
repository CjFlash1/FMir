[33mcommit d9d24ead9f2bc8a00d00d104b3fd4312155b3bc9[m
Author: FujimirDev <dev@fujimir.local>
Date:   Fri Jan 2 00:29:08 2026 +0000

    Feat: Admin cleanup modes, order deletion, checkout improvements, and backup/seed scripts

[1mdiff --git a/src/lib/novaposhta.ts b/src/lib/novaposhta.ts[m
[1mindex 3088403..2bf20ae 100644[m
[1m--- a/src/lib/novaposhta.ts[m
[1m+++ b/src/lib/novaposhta.ts[m
[36m@@ -1,7 +1,7 @@[m
 import { prisma } from "@/lib/prisma";[m
 [m
 const NP_API_URL = "https://api.novaposhta.ua/v2.0/json/";[m
[31m-export const DEFAULT_NP_KEY = "1f3dd12c344c40df149f57c68f13ddf7";[m
[32m+[m[32m// DEFAULT_NP_KEY removed to enforce user configuration[m
 [m
 interface NPRequest {[m
     apiKey: string;[m
[36m@@ -11,18 +11,22 @@[m [minterface NPRequest {[m
 }[m
 [m
 export async function npRequest(modelName: string, calledMethod: string, methodProperties: Record<string, any>, explicitApiKey?: string) {[m
[31m-    let apiKey = explicitApiKey || DEFAULT_NP_KEY;[m
[32m+[m[32m    let apiKey = explicitApiKey;[m
 [m
[31m-    // Only fetch from DB if no explicit key is provided and we are using default[m
[32m+[m[32m    // Only fetch from DB if no explicit key is provided[m
     if (!explicitApiKey) {[m
         try {[m
             const setting = await prisma.setting.findUnique({ where: { key: "novaposhta_api_key" } });[m
             if (setting?.value) apiKey = setting.value;[m
         } catch (e) {[m
[31m-            console.warn("Failed to fetch NP API Key from DB, using default.");[m
[32m+[m[32m            console.warn("Failed to fetch NP API Key from DB.");[m
         }[m
     }[m
 [m
[32m+[m[32m    if (!apiKey) {[m
[32m+[m[32m        return { success: false, errors: ["Nova Poshta API Key is missing. Please configure it in Settings."] };[m
[32m+[m[32m    }[m
[32m+[m
     const body: NPRequest = {[m
         apiKey: apiKey,[m
         modelName,[m

[33mcommit bb85d2be072ef938859f04d9f3a8df87dcff026f[m
Author: FujimirDev <dev@fujimir.local>
Date:   Wed Dec 31 00:10:32 2025 +0000

    Nova Poshta Integration Finalization: API Key Management & Validation, Enhanced Sender/Recipient Logic, Upload UI Fixes

[1mdiff --git a/src/lib/novaposhta.ts b/src/lib/novaposhta.ts[m
[1mindex 5f0aba8..3088403 100644[m
[1m--- a/src/lib/novaposhta.ts[m
[1m+++ b/src/lib/novaposhta.ts[m
[36m@@ -1,5 +1,7 @@[m
[32m+[m[32mimport { prisma } from "@/lib/prisma";[m
[32m+[m
 const NP_API_URL = "https://api.novaposhta.ua/v2.0/json/";[m
[31m-export const NP_API_KEY = "1f3dd12c344c40df149f57c68f13ddf7";[m
[32m+[m[32mexport const DEFAULT_NP_KEY = "1f3dd12c344c40df149f57c68f13ddf7";[m
 [m
 interface NPRequest {[m
     apiKey: string;[m
[36m@@ -8,9 +10,21 @@[m [minterface NPRequest {[m
     methodProperties: Record<string, any>;[m
 }[m
 [m
[31m-export async function npRequest(modelName: string, calledMethod: string, methodProperties: Record<string, any>) {[m
[32m+[m[32mexport async function npRequest(modelName: string, calledMethod: string, methodProperties: Record<string, any>, explicitApiKey?: string) {[m
[32m+[m[32m    let apiKey = explicitApiKey || DEFAULT_NP_KEY;[m
[32m+[m
[32m+[m[32m    // Only fetch from DB if no explicit key is provided and we are using default[m
[32m+[m[32m    if (!explicitApiKey) {[m
[32m+[m[32m        try {[m
[32m+[m[32m            const setting = await prisma.setting.findUnique({ where: { key: "novaposhta_api_key" } });[m
[32m+[m[32m            if (setting?.value) apiKey = setting.value;[m
[32m+[m[32m        } catch (e) {[m
[32m+[m[32m            console.warn("Failed to fetch NP API Key from DB, using default.");[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
     const body: NPRequest = {[m
[31m-        apiKey: NP_API_KEY,[m
[32m+[m[32m        apiKey: apiKey,[m
         modelName,[m
         calledMethod,[m
         methodProperties,[m

[33mcommit bf62394822611bb6506433a16364e8c3705f7c85[m
Author: FujimirDev <dev@fujimir.local>
Date:   Tue Dec 30 04:17:24 2025 +0000

    Fix Nova Poshta TTN: Force recipient name update, robust sender contact handling, new UI with payer selection

[1mdiff --git a/src/lib/novaposhta.ts b/src/lib/novaposhta.ts[m
[1mnew file mode 100644[m
[1mindex 0000000..5f0aba8[m
[1m--- /dev/null[m
[1m+++ b/src/lib/novaposhta.ts[m
[36m@@ -0,0 +1,27 @@[m
[32m+[m[32mconst NP_API_URL = "https://api.novaposhta.ua/v2.0/json/";[m
[32m+[m[32mexport const NP_API_KEY = "1f3dd12c344c40df149f57c68f13ddf7";[m
[32m+[m
[32m+[m[32minterface NPRequest {[m
[32m+[m[32m    apiKey: string;[m
[32m+[m[32m    modelName: string;[m
[32m+[m[32m    calledMethod: string;[m
[32m+[m[32m    methodProperties: Record<string, any>;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mexport async function npRequest(modelName: string, calledMethod: string, methodProperties: Record<string, any>) {[m
[32m+[m[32m    const body: NPRequest = {[m
[32m+[m[32m        apiKey: NP_API_KEY,[m
[32m+[m[32m        modelName,[m
[32m+[m[32m        calledMethod,[m
[32m+[m[32m        methodProperties,[m
[32m+[m[32m    };[m
[32m+[m
[32m+[m[32m    const response = await fetch(NP_API_URL, {[m
[32m+[m[32m        method: "POST",[m
[32m+[m[32m        headers: { "Content-Type": "application/json" },[m
[32m+[m[32m        body: JSON.stringify(body),[m
[32m+[m[32m    });[m
[32m+[m
[32m+[m[32m    const data = await response.json();[m
[32m+[m[32m    return data;[m
[32m+[m[32m}[m
